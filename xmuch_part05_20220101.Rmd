---
title: "X-much in IrE and AusE - Part 5: Statistical Analysis"
author: "Anonymous"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  word_document
bibliography: bibliography.bib
link-citations: yes
---

This document focuses on the use of the X-much structure in Irish and Australian English. 

This part of the analysis performs the data analysis. The data is processed using *tidyverse* package(s) [@tidyverse] and the statistical analysis uses \chi^2^-tests [see @cochran1952x2], configural frequency analysis [see @lienert1975cfa] using the *cfa* package [@cfa], and conditional inference trees using the *party* [@party] and *partykit* [@partykit] packages.

# Session preparation

* install packages

```{r install, eval = F, message = F, warning = F}
install.packages("tidyverse")
install.packages("here")
install.packages("readxl")
install.packages("flextable")
install.packages("quanteda")
install.packages("tidytext")
install.packages("cfa")
install.packages("report")
install.packages("party")
install.packages("partykit")
```


* load packages

* set options


```{r xmprep_2_01}
# load packages
library(tidyverse)
library(here)
library(readxl)
library(flextable)
library(quanteda)
library(tidytext)
library(cfa)
library(vcd)
library(party)
library(partykit)
# setting options
options(stringsAsFactors = F)
```

# Load data

```{r load, message=F, warning=F}
xmuch <- base::readRDS(file = here::here("data", "xmuch.rda"))
# inspect
head(xmuch, 10)
```

# Statistical Analysis

## Single vs Multiword

RQ: do ire and aus differ regarding the status of x (single word vs multiword)?

```{r}
phrasetb <- xmuch %>%
  dplyr::filter(control == "test") %>%
  dplyr::select(variety, element) %>%
  dplyr::group_by(variety, element) %>%
  dplyr::summarise(freq = n()) %>%
  dplyr::group_by(variety) %>%
  dplyr::mutate(total = sum(freq)) %>%
  dplyr::ungroup() %>%
  dplyr::rowwise() %>%
  dplyr::mutate(percent = round(freq/total*100, 2))
# inspect
phrasetb
```



```{r}
phrase_x2 <- phrasetb %>%
  dplyr::select(-total, -percent) %>%
  tidyr::spread(element, freq) %>%
  as.matrix()
# add rownames
rownames(phrase_x2) <- phrase_x2[, 1]
phrase_x2 <- phrase_x2[, 2:3]
# convert to numeric
phrase_x2 <- t(apply(phrase_x2, 1, function(x){ 
  x <- as.numeric(x) }))
# add column names
#colnames(phrase_x2) <- names(table(phrasetb$element))
colnames(phrase_x2) <- c("single-word", "multi-word exp.")
# inspect
phrase_x2
```

* perform X2-test [@stats]

```{r}
chisq.test(phrase_x2)
```


generate visualization


```{r}
# open window
png(here::here("images", "multiword_assoc.png"), width = 500, height = 450)
# generate plot
assocplot(phrase_x2)
# close window
dev.off() 
assocplot(phrase_x2)
```


## Emotionality

```{r}
xmdtb <- xmuch %>%
  dplyr::select(variety, x, pos, emo, polarity, control) %>%
  dplyr::rename(word = x)
# inspect
head(xmdtb)
```


* tabulation

```{r tb}
tb1 <-base::readRDS(file = here::here("tables", "tb1.rda")) %>%
  dplyr::mutate(variety = stringr::str_replace_all(text, ".*_([a-z]{2,2})_.*", "\\1"),
                variety = ifelse(variety == "au", "Australia", "Ireland")) %>%
  dplyr::group_by(variety) %>%
  dplyr::summarise(words = sum(words),
                   texts = n())
# inspect
head(tb1)
```


```{r}
xmdtb %>%
  dplyr::group_by(variety, control) %>%
  dplyr::summarise(freq = n())
```

### X2

RQ: Does the emotionality of words in the test data (in the x-much construction) differ from the emotionality in the control data?

```{r}
emo_tb1 <- xmdtb %>%
  dplyr::group_by(emo, control) %>%
  dplyr::summarise(freq = n())
# inspect
head(emo_tb1)
```

Perform x2-test

```{r}
emo_x2 <- emo_tb1 %>%
  tidyr::spread(control, freq) %>%
  as.matrix()
rn<- emo_x2[,1]
emo_x2 = emo_x2[, 2:3]
emo_x2 <- apply(emo_x2, 2, as.numeric)
rownames(emo_x2) <- rn
emo_x2
# perform x2 test
chisq.test(emo_x2)
```

The words in the x-much construction are significantly more emotional compared to the words in the control data.

```{r}
# adapt column names
colnames(emo_x2) <- c("control", "Xmuch")

# open window
png(here::here("images", "emo_assoc.png"), width = 500, height = 350)
# generate plot
assocplot(emo_x2)
# close window
dev.off() 
assocplot(emo_x2)
```


###  CFA

```{r}
emo_tb3 <- xmdtb %>%
  dplyr::group_by(emo, variety, control) %>%
  dplyr::summarise(freq = n())
# inspect
emo_tb3
```

```{r}
configs <- emo_tb3 %>%
  dplyr::select(variety, emo, control)
counts = emo_tb3$freq
cfa::cfa(configs, counts)
```

There are significantly more negative adjectives in the x-much construction in the Australian data after corrections compared to any other configuration.

### Visualization

* prepare data

```{r}
emo_vis <- emo_tb3 %>%
  dplyr::ungroup() %>%
  dplyr::rename(Freq = freq,
                Emotionality = emo,
                Variety = variety,
                Data = control) %>%
  dplyr::mutate_if(is.character, factor) %>%
  dplyr::mutate(Data = ifelse(Data == "test", "X-much", "control"))
# inspect
head(emo_vis)
```


```{r}
emo1 <- emo_vis %>%
  dplyr::filter(Emotionality == "emotional") %>%
  dplyr::pull()
emo2 <- emo_vis %>%
  dplyr::filter(Emotionality == "nonemotional") %>%
  dplyr::pull()
# add dimnames
column.names <- c("Australia", "Ireland")
row.names <- c("control", "X-much")
matrix.names <- c("emotional", "nonemotional")
# generate matrix
emo_mx <- array(c(emo1, emo2), dim = c(2, 2, 2),
                  dimnames = list(row.names, 
                                  column.names,
                                  matrix.names))
# inspect
emo_mx
```



* basic mosaic plot

```{r}
mosaic(emo_mx,
       shade = TRUE,
       direction = c("h",  "v", "v"),
       just_labels = c("center", "center", "center", "center"))
```

* prettyfied mosaic plot

```{r}
# open connection
png(here::here("images", "emo_mosaic.png"), width = 750, height = 300)
# generate plot
mosaic(emo_mx,
       axis.cex = 15,
       shade = TRUE,
       direction = c("h",  "v", "v"),
       just_labels = c("center", "center", "center", "center"))
# close window
dev.off() 
```





## Polarity

```{r}
pol_tb2 <- xmuch %>%
  dplyr::mutate(polarity = ifelse(polarity == "nonemotional", "neutral", polarity)) %>%
  dplyr::group_by(polarity, control) %>%
  dplyr::summarise(freq = n())
# inspect
pol_tb2
```

### X2

Perform x2-test

```{r}
pol_x2 <- pol_tb2 %>%
  tidyr::spread(control, freq) %>%
  as.matrix()
# inspect
pol_x2
```


```{r}
rn <- pol_x2[,1]
pol_x2 = pol_x2[, 2:3]
pol_x2 <- apply(pol_x2, 2, as.numeric)
rownames(pol_x2) <- rn
pol_x2
# perform x2 test
chisq.test(pol_x2)
```

The words in the x-much construction are significantly more emotional compared to the words in the control data.

```{r}
# adapt column names
colnames(pol_x2) <- c("control", "Xmuch")

# open window
png(here::here("images", "pol_assoc.png"), width = 500, height = 350)
# generate plot
assocplot(pol_x2)
# close window
dev.off() 
assocplot(pol_x2)
```


### CFA

```{r}
pol_tb1 <- xmuch %>%
  dplyr::mutate(polarity = ifelse(polarity == "nonemotional", "neutral", polarity)) %>%
  dplyr::group_by(polarity, variety, control) %>%
  dplyr::summarise(freq = n())
# inspect
pol_tb1
```

```{r}
configs <- pol_tb1 %>%
  dplyr::select(variety, polarity, control)
counts = pol_tb1$freq
cfa::cfa(configs, counts)
```

### Visualization

* prepare data

```{r}
pol_vis <- pol_tb1 %>%
  dplyr::ungroup() %>%
  dplyr::rename(Freq = freq,
                Polarity = polarity,
                Variety = variety) %>%
  dplyr::mutate_if(is.character, factor)
# inspect
pol_vis
```


* prepare data


```{r}
pol1 <- pol_vis %>%
  dplyr::filter(Polarity == "positive") %>%
  dplyr::pull(Freq)
pol2 <- pol_vis %>%
  dplyr::filter(Polarity == "neutral") %>%
  dplyr::pull(Freq)
pol3 <- pol_vis %>%
  dplyr::filter(Polarity == "negative") %>%
  dplyr::pull(Freq)
# add dimnames
column.names <- c("Australia", "Ireland")
row.names <- c("control", "X-much")
matrix.names <- c("positive", "neutral", "negative")
# generate matrix
pol_mx <- array(c(pol1, pol2, pol3), dim = c(2, 2, 3),
                  dimnames = list(row.names, 
                                  column.names,
                                  matrix.names))
# inspect
pol_mx
```



* basic mosaic plot

```{r}
# open window
png(here::here("images", "pol_mosaic.png"), width = 750, height = 300)
# generate plot
mosaic(pol_mx,
       shade = TRUE,
       direction = c("h",  "v", "v"),
       just_labels = c("center", "center", "center", "center"))
# close window
dev.off() 
# show plot
mosaic(pol_mx,
       shade = TRUE,
       direction = c("h",  "v", "v"),
       just_labels = c("center", "center", "center", "center"))
```


* alternative mosaic plot

```{r}
# define cols
mycols <- rev(RColorBrewer::brewer.pal(3, "Greys"))
vcd::mosaic(Polarity ~ Variety, data = pol_vis, 
            direction = c("v",  "h"),
            rot_labels = c(0, 0, 0, 0),
            highlighting_fill = mycols,
            labeling_args = list(tl_labels = c(F, T),
                                 set_varnames = c(Polarity = "Polarity\n\n\n\n\n\n\n"),
                                 offset_varnames = c(0, 0, 0, 1),
                                 just_labels = c("center", "center", "center", "right")))
# save plot
#ggsave(here::here("images", "pol_var.png"), units = "cm", width = 8, height = 6)
```



## POS


```{r}
pos_tb1 <- xmuch %>%
  dplyr::group_by(pos, control) %>%
  dplyr::summarise(freq = n())
# inspect
pos_tb1
```

### X2

Perform x2-test

```{r}
pos_x2 <- pos_tb1 %>%
  tidyr::spread(control, freq) %>%
  as.matrix()
# inspect
pos_x2
```


```{r}
rn <- pos_x2[,1]
pos_x2 = pos_x2[, 2:3]
pos_x2 <- apply(pos_x2, 2, as.numeric)
rownames(pos_x2) <- rn
pos_x2
# perform x2 test
chisq.test(pos_x2)
```

generate association plot

```{r}
# adapt column names
colnames(pos_x2) <- c("control", "Xmuch")

# open window
png(here::here("images", "pos_assoc.png"), width = 500, height = 350)
# generate plot
assocplot(pos_x2)
# close window
dev.off() 
assocplot(pos_x2)
```

### CFA

process data

```{r}
pos_tb2 <- xmuch %>%
  dplyr::group_by(pos, variety, control) %>%
  dplyr::summarise(freq = n())
# inspect
pos_tb2
```

perform CFA

```{r}
configs <- pos_tb2 %>%
  dplyr::select(variety, pos, control)
counts = pos_tb2$freq
cfa::cfa(configs, counts)
```


### Visualization

* prepare data

```{r}
pos_vis <- pos_tb2 %>%
  dplyr::ungroup() %>%
  dplyr::rename(Freq = freq,
                POS = pos,
                Variety = variety) %>%
  dplyr::mutate_if(is.character, factor)
# inspect
pos_vis
```



* prepare data


```{r}
pos1 <- pos_vis %>%
  dplyr::filter(POS == "Adjective") %>%
  dplyr::pull(Freq)
pos2 <- pos_vis %>%
  dplyr::filter(POS == "Noun") %>%
  dplyr::pull(Freq)
pos3 <- pos_vis %>%
  dplyr::filter(POS == "other") %>%
  dplyr::pull(Freq)
pos4 <- pos_vis %>%
  dplyr::filter(POS == "Verb") %>%
  dplyr::pull(Freq)
# add dimnames
column.names <- c("Australia", "Ireland")
row.names <- c("control", "X-much")
matrix.names <- c("Adj.", "Noun", "other", "Verb")
# generate matrix
pos_mx <- array(c(pol1, pol2, pol3), dim = c(2, 2, 4),
                  dimnames = list(row.names, 
                                  column.names,
                                  matrix.names))
# inspect
pos_mx
```




* basic mosaic plot

```{r}
# open window
png(here::here("images", "pos_mosaic.png"), width = 750, height = 300)
# generate plot
mosaic(pos_mx,
       shade = TRUE,
       direction = c("h",  "v", "v"),
       just_labels = c("center", "center", "center", "center"),
       rot_labels=c(0,0,90,90),
       offset_labels = c(0, 0, 0.5,0))
# close window
dev.off() 
# show plot
mosaic(pos_mx,
       shade = TRUE,
       direction = c("h",  "v", "v"),
       just_labels = c("center", "center", "center", "center"),
       rot_labels=c(0,0,90,90),
       offset_labels = c(0, 0, 0.5,0))
```



## Words


Words overrepresented in x-much


**Constructionalization more advanced in AusE**

### CFA (wo vareity)

RQ: Regardless of variety, are there words that are significantly attracted by the x-much construction?

```{r}
wordcat_tb <- xmuch %>%
  dplyr::group_by(control, x) %>%
  dplyr::mutate(freq = n()) %>%
  dplyr::mutate(x = ifelse(freq < 2, "other", x)) %>%
  dplyr::ungroup() %>%
  dplyr::group_by(x, control) %>%
  dplyr::summarise(freq = n())
configs <- wordcat_tb %>%
  dplyr::select(control, x)
counts = wordcat_tb$freq
cfa::cfa(configs, counts)

```

```{r}
r7 <- cfa::cfa(configs, counts)
words <- r7$table %>%
  as.data.frame() %>%
  dplyr::filter(sig.z == T) %>%
  dplyr::pull(label) %>%
  stringr::str_remove_all("test ")
words
```

Words that are significantly over-represented in the x-much construction: 

### CFA (w variety)

RQ: Do the words that are significantly attracted by the x-much construction differ across varieties?

```{r}
wordcat_tb <- xmuch %>%
  dplyr::group_by(control, variety, x) %>%
  dplyr::mutate(freq = n()) %>%
  dplyr::mutate(x = ifelse(freq < 2, "other", x)) %>%
  dplyr::ungroup() %>%
  dplyr::group_by(x, variety, control) %>%
  dplyr::summarise(freq = n())
configs <- wordcat_tb %>%
  dplyr::select(control, variety, x)
counts = wordcat_tb$freq
cfa::cfa(configs, counts)
```

```{r}
r8 <- cfa::cfa(configs, counts)
words <- r8$table %>%
  as.data.frame() %>%
  dplyr::filter(stringr::str_detect(label, "control", negate = TRUE),
                sig.z == T) %>%
  dplyr::pull(label) %>%
  stringr::str_remove_all("test ")
words
```

The words that are attracted to the x-much construction in Ireland are less negative compared to the words that are attracted to the x-much construction in Oz. Compare *excuses*, *coincidence*, or *agenda* (Ireland) to *jealous*, *paranoid*, *hypocrite*, *creepy*, *threatened*, or *entitled* (Australia).

## CIT

Process data

```{r}
citdata <- xmuch %>%
  dplyr::filter(control == "test") %>%
  dplyr::select(variety, pos, element, emo, polarity, x) %>%
  dplyr::rename(X = x,
                Variety = variety,
                Polarity = polarity,
                Emotionality = emo,
                Unit = element,
                POS = pos) %>%
  dplyr::group_by(Variety, POS, Unit, Emotionality, Polarity, X) %>%
  dplyr::summarise(Frequency = n()) %>%
  dplyr::ungroup()
# inspect
head(citdata)
```

Perform CIT analysis with the *party* [@party] and the *partykit* [@partykit] packages

```{r}
# set.seed
set.seed(111)        
# apply bonferroni correction (1 minus alpha multiplied by n of predictors)
control = ctree_control(mincriterion = 1-(.05*ncol(citdata)-1))
# convert character strings to factors
citdata <- citdata %>%
  dplyr::mutate_if(is.character, factor)
# create initial conditional inference tree model
citd.ctree <- partykit::ctree(Frequency ~ Variety + POS + Unit + Emotionality + Polarity,
                    data = citdata)
plot(citd.ctree, gp = gpar(fontsize = 8)) # plot final ctree
```


# Outro

```{r}
sessionInfo()
```


# References


