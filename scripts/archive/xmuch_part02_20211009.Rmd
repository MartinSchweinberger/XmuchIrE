---
title: "X-much CXN in IrE - Part 2: Data processing"
author: "Anonymous"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  word_document
bibliography: bibliography.bib
link-citations: yes
---

This document focuses on the use of the X-much construction in Irish English. 

This part of the analysis performs the data processing and extracting examples of the X-much construction.

# Session preparation

cleaning the workspace, loading packages, setting options, and defining paths.

```{r xmprep_2_01}
# load packages
library(tidyverse)
library(here)
library(readxl)
library(flextable)
library(quanteda)
# setting options
options(stringsAsFactors = F)
# set paths
cpath <- "D:\\Uni\\Korpora\\Edited\\GloWbe_postagged"
```

# Extract and process texts from corpus

Extract sample and save it to disc

```{r xm_2_03, eval=T}
# list files
cfiles <- list.files(cpath, pattern = ".txt", full.names = T)
# load texts
texts <- unlist(sapply(cfiles, function(x){
  filename <- str_remove_all(x, ".*/")
  filename <- str_remove_all(filename, ".txt")
   x <- readLines(x)
   x <- paste0(x, collapse = " ")
   x <- str_split(str_replace_all(x, "##", "~~~##"), "~~~")
   x <- unlist(x)
}))
# inspect data
str(texts)
```

Clean data

```{r xm_2_05, eval=T}
# simplify names
names(texts) <- str_remove_all(names(texts), ".*/")
names(texts) <- str_replace_all(names(texts), ".txt", "_")
# clean texts
texts <- texts[which(texts != "")]
# inspect
str(texts)
```

## Concordancing of *much*

```{r xm_2_07,eval=T}
# kwic
kwics <- kwic(x = texts, 
              window = 20,
              pattern = "much", 
              valuetype = "regex",
              case_insensitive = F) %>%
  as.data.frame() %>%
  dplyr::mutate(id = 1:nrow(.))
# save data
base::saveRDS(kwics, file = here::here("data", "kwics.rda"))
# load data
kwics  <- base::readRDS(file = here::here("data", "kwics.rda"))
# inspect data
head(kwics)
```


## Clean data{-}


```{r}
clean_kwic1 <- kwics %>%
  dplyr::mutate(clean_content = paste0(pre, " << ", keyword, " >> ", post)) %>%
  dplyr::mutate(clean_content = stringr::str_remove_all(clean_content, 
                                                        "\\/ [@%]{0,1}[:alnum:]{1,4}[@%]{0,1}_{0,1}[@%]{0,1}[:alnum:]{0,4}[@%]{0,1}_{0,1}[@%]{0,1}[:alnum:]{0,4}[@%]{0,1}")) %>%
  dplyr::mutate(clean_content = stringr::str_remove_all(clean_content, "@")) %>%
  dplyr::mutate(clean_content = stringr::str_remove_all(clean_content, "%")) %>%
  dplyr::mutate(clean_content = stringr::str_squish(clean_content)) %>%
  dplyr::filter(stringr::str_detect(clean_content, " [:alnum:]{1,3} <<", negate = TRUE),
                stringr::str_detect(clean_content, " [VERYvery]{4,4} <<", negate = TRUE),
                stringr::str_detect(clean_content, " [SOso]{2,} <<", negate = TRUE),
                stringr::str_detect(clean_content, " have <<", negate = TRUE),
                stringr::str_detect(clean_content, " were <<", negate = TRUE),
                stringr::str_detect(clean_content, " becoming <<", negate = TRUE),
                stringr::str_detect(clean_content, " write <<", negate = TRUE),
                stringr::str_detect(clean_content, " hurt <<", negate = TRUE),
                stringr::str_detect(clean_content, " London <<", negate = TRUE),
                stringr::str_detect(clean_content, " attract <<", negate = TRUE),
                stringr::str_detect(clean_content, " get[ting]{0,4} <<", negate = TRUE),
                stringr::str_detect(clean_content, " that <<", negate = TRUE),
                stringr::str_detect(clean_content, " this .{0,3}<<", negate = TRUE),
                stringr::str_detect(clean_content, " [Aafter]{5,5} <<", negate = TRUE),
                stringr::str_detect(clean_content, " pretty <<", negate = TRUE),
                stringr::str_detect(clean_content, " do[esing]{0,3} <<", negate = TRUE),
                stringr::str_detect(clean_content, " without <<", negate = TRUE),
                stringr::str_detect(clean_content, " ' s <<", negate = TRUE),
                stringr::str_detect(clean_content, " n't <<", negate = TRUE),
                stringr::str_detect(clean_content, "How @ <<", negate = TRUE),
                stringr::str_detect(clean_content, " >> [:alnum:]{1,3} ", negate = TRUE),
                stringr::str_detect(clean_content, " >> about ", negate = TRUE),
                stringr::str_detect(clean_content, " >> faster ", negate = TRUE),
                stringr::str_detect(clean_content, " >> confusion ", negate = TRUE),
                stringr::str_detect(clean_content, " >> anyway ", negate = TRUE),
                stringr::str_detect(clean_content, " >> later ", negate = TRUE),
                stringr::str_detect(clean_content, " >> [MOREmore]{4,4} ", negate = TRUE),
                stringr::str_detect(clean_content, " >> [LESSless]{4,4} ", negate = TRUE),
                stringr::str_detect(clean_content, " >> [WORSEworse]{5,5} ", negate = TRUE),
                stringr::str_detect(clean_content, " >>$", negate = TRUE),
                stringr::str_detect(clean_content, " >> [:alnum:]{0,} {0,1}\\? / \\? | >> [:alnum:]{0,} {0,1}\\! / \\! | >> [:alnum:]{0,} {0,1}\\. / \\. | >> [:alnum:]{0,} {0,1}\\; / \\; | >> [:alnum:]{0,} {0,1}\\, / \\, "))
# inspect data
head(clean_kwic1$clean_content); nrow(clean_kwic1)
```

## Save data{-}

```{r}
# save data
base::saveRDS(clean_kwic1, file = here::here("data", "kwics_semiclean.rda"))
# load kwics
clean_kwic1  <- base::readRDS(file = here::here("data", "kwics_semiclean.rda"))
# inspect data
head(clean_kwic1); nrow(clean_kwic1)
```

```{r}
clean_kwic2 <- clean_kwic1 %>%
  dplyr::select(-from, -to) %>%
  dplyr::mutate(PrePosTag = str_remove_all(pre, ".*/"),
                PrePosTag = stringr::str_squish(PrePosTag),
                PostPosTag = str_remove_all(post, "^/"),
                PostPosTag = str_remove_all(PostPosTag, "/.*"),
                PostPosTag = str_remove_all(stringr::str_squish(PostPosTag), ".* ") ) %>%
  dplyr::filter(PostPosTag != ".",
                PostPosTag != ",")
# inspect data
head(clean_kwic2); nrow(clean_kwic2)
```


```{r}
clean_kwic3 <- clean_kwic2 %>%
  dplyr::filter(PostPosTag == "?" | PostPosTag == "!" | PostPosTag == "[:alnum:]{1,}" ) %>%
  dplyr::filter(str_detect(clean_content, " << mucho >> ", negate = TRUE)) %>%
  dplyr::mutate(clean_content = stringr::str_replace_all(clean_content, " / [:punct:] ", " "),
                clean_content = stringr::str_replace_all(clean_content, "< {1,}[:alnum:]{1,2} {1,}>", " "),
                clean_content= stringr::str_squish(clean_content)) 
# inspect data
head(clean_kwic3); nrow(clean_kwic3); clean_kwic3$clean_content
```

## Manual correction{-}

```{r}
hits <- c(599, 5525, 5530,5816, 11582, 13200, 17046, 20991, 21795, 30236, 34972, 
          35020, 35120, 35308, 37854, 39600, 40453, 40876, 41221, 41370, 46497, 
          46498, 47517, 51719, 52752, 53110, 57010, 60037, 70653, 70684, 70843, 
          71039, 87422, 89308, 89535)
kwics <- clean_kwic3 %>%
  dplyr::filter(id %in% hits)
```


## Save data to disc{-}

```{r}
write.table(kwics, here::here("data", "kwics.txt"), sep = "\t") 
```


## Extract session information{-}

```{r}
sessionInfo()
```


***

The END

***

