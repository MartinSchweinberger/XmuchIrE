---
title: "X-much CXN in IrE - Part 2: Data processing"
author: "Anonymous"
date: "`r format(Sys.time(), '%Y-%m-%d')`"
output:
  word_document
bibliography: bibliography.bib
link-citations: yes
---

This document focuses on the use of the X-much construction in Irish English. 

This part of the analysis performs the data processing and extracting examples of the X-much construction.

# Session preparation

cleaning the workspace, loading packages, setting options, and defining paths.

```{r xmprep_2_01}
# load packages
library(tidyverse)
library(here)
library(readxl)
library(flextable)
library(quanteda)
# setting options
options(stringsAsFactors = F)
# set paths
cpath <- "D:\\Uni\\Korpora\\Edited\\GloWbe_postagged"
```

# Extract and process texts from corpus

Extract sample and save it to disc

```{r xm_2_03, eval=T}
# list files
cfiles <- list.files(cpath, pattern = ".txt", full.names = T)
# load texts
texts <- unlist(sapply(cfiles, function(x){
  filename <- str_remove_all(x, ".*/")
  filename <- str_remove_all(filename, ".txt")
   x <- readLines(x)
   x <- paste0(x, collapse = " ")
   x <- str_split(str_replace_all(x, "##", "~~~##"), "~~~")
   x <- unlist(x)
}))
# inspect data
str(texts)
```

Clean data

```{r xm_2_05, eval=T}
# simplify names
names(texts) <- str_remove_all(names(texts), ".*/")
names(texts) <- str_replace_all(names(texts), ".txt", "_")
# clean texts
texts <- texts[which(texts != "")]
# inspect
str(texts)
```

extract instances of much

```{r xm_2_07,eval=T}
# kwic
kwics <- kwic(x = texts, 
              window = 10,
              pattern = "much", 
              valuetype = "regex",
              case_insensitive = F)
# save data
base::saveRDS(kwics, file = here::here("data", "kwics.rda"))
```

## Load processed data



```{r xm_2_07}
# kwic
kwics  <- base::readRDS(file = here::here("data", "kwics.rda"))
# inspect data
head(kwics)
```





```{r}
clean_kwic1 <- kwics %>%
  dplyr::mutate(clean_content = paste0(pre, " << ", keyword, " >> ", post))
# inspect data
clean_kwic1
```

```{r}
clean_kwic2 <- clean_kwic1 %>%
  dplyr::mutate(clean_content = stringr::str_remove_all(clean_content, 
                                                        "\\/ [:alnum:]{1,4}[@]{0,1}_{0,1}[:alnum:]{0,4}"))# %>%
  #dplyr::mutate(clean_content = stringr::str_remove_all(clean_content, 
                                                        "[^<'[:^punct:]]")) %>%
  dplyr::mutate(clean_content = stringr::str_squish(clean_content))
# inspect data
clean_kwic2
```


```{r}
clean_kwic3 <- clean_kwic2 %>%
  dplyr::filter(stringr::str_detect(clean_content, " so <<", negate = TRUE),
                stringr::str_detect(clean_content, " as <<", negate = TRUE),
                stringr::str_detect(clean_content, " in <<", negate = TRUE),
                stringr::str_detect(clean_content, " too <<", negate = TRUE),
                stringr::str_detect(clean_content, " very <<", negate = TRUE),
                stringr::str_detect(clean_content, " me <<", negate = TRUE),
                stringr::str_detect(clean_content, " how <<", negate = TRUE),
                stringr::str_detect(clean_content, " is <<", negate = TRUE),
                stringr::str_detect(clean_content, " was <<", negate = TRUE),
                stringr::str_detect(clean_content, " this <<", negate = TRUE),
                stringr::str_detect(clean_content, " A <<", negate = TRUE),
                stringr::str_detect(clean_content, " do <<", negate = TRUE),
                stringr::str_detect(clean_content, " ' s <<", negate = TRUE),
                stringr::str_detect(clean_content, " >> of ", negate = TRUE),
                stringr::str_detect(clean_content, " >> to ", negate = TRUE),
                stringr::str_detect(clean_content, " >> about ", negate = TRUE))
# inspect data
head(clean_kwic3$clean_content); nrow(clean_kwic3)
```



```{r xm_2_09}
# filtering
kwics_clean <- kwics %>%
  mutate(pre_short = str_remove_all(pre, ".* ")) %>%
  filter(pre_short == "jj") %>%
  mutate(post_short = str_squish(post),
         post_short = str_replace_all(post_short, "/ ", "/"),
         post_short = str_replace(post_short, " ", "_"),
         post_short = str_replace(post_short, " ", "_"),
         post_short = str_remove_all(post_short, " .*"),
         post_short = str_replace_all(post_short, ".*jj.*", "hit"),
         post_short = str_replace_all(post_short, ".*rrr.*", "hit"),
         post_short = str_replace_all(post_short, ".*rgr.*", "hit")) %>%
  #filter(post_short != "hit") %>%
  as.data.frame()  %>%
  dplyr::mutate(clean_content = paste0(pre, " << ", keyword, " >> ", post))
# inspect
head(kwics_clean)
```

clean kwics

```{r xm_1_07}
# kwic
kwic <- kwics
# inspect
head(kwic)
```



***

The END

***

